# ngroot
## Flexible and composable Seed Library for Asp.Net Applications

⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡾⠛⠳⣄⠀⣠⣤⣤⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣧⠘⣆⣿⠟⢹⠈⠁⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣄⡀⠀⣠⣬⡓⡿⡏⠀⢸⠀⠀⡏⠸⣦⡴⣿⠛⣷⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⢧⡐⣽⠟⠉⡟⠙⠃⡇⠀⠀⠀⠀⠀⠀⡽⠀⠀⠀⡏⣘⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⢻⡇⠀⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⠇⢸⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣇⡴⠛⣿⣦⠀⠀⠀⠀⠀⠀⢀⡞⠙⣿⣦⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡿⣷⣶⣿⣿⠀⠀⠀⠀⠀⠀⠘⣿⣶⣿⡿⠁⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠈⠉⠉⠁⢰⣶⣶⣶⣶⣶⠀⠈⠉⠉⠀⣄⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣴⡀⠀⠀⠈⠛⠿⠭⠔⠋⠀⠀⠀⣄⣰⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠿⠷⠤⣶⣤⣤⣤⣤⡾⠾⠞⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡞⠳⣄⣀⣀⡴⢾⡷⣄⡇⢸⣿⢟⣲⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠳⣤⣼⣟⣩⡽⣿⠁⢮⠳⣼⠟⠛⣦⢉⣧⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⠀⢠⡿⢤⡈⢧⡟⠀⠀⠈⠿⣤⡼⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣷⠄⠙⠻⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣶⣶⣾⣷⣶⣶⣿⣿⣿⣶⣶⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠿⢿⣿⣿⣿⣿⣿⣿⡿⠿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀


Seggregate your data into discreate, composable objects with full DI Support and agnostic to any data library:

```C#
public class UsersLoader: ModelLoader<User>,
    IUsersLoader
{
    public UsersLoader(
        IOptions<NgrootSettings> settings,
        IUserRepository userRepository
    ) : base(settings)
    {
        Setup("Users")
        .FindDuplicatesWith(m => userRepository.FindByUserNameAsync(m.UserName))
        .CreateModelUsing(m => userRepository.CreateAsync(m))
    }
}
```

You can Express Relationships in your data conveniently via Fluent Interface too:
```C#
public class AssignedPermissionsLoader : ModelLoader<AssignedPermission>
{
    public AssignedPermissionsLoader(IFileLoader fileLoader, IOptions<NgrootSettings> settings, IAssignedPermissionsRepository assignedPermissionsRepository) : base(settings)
    {
        Setup("AssignedPermissions")
        .FindDuplicatesWith(m => assignedPermissionsRepository.GetByPermissionAndRoleAsync(m.PermissionId, m.RoleId))
        .CreateModelUsing(m => assignedPermissionsRepository.CreateAsync(m))
        .UseFileLoader(() => fileLoader)
        // Permission Map
        .With<Permission>("Permissions", m => m.PermissionId,
        permission => permission.Id,
        (permission, m) => m.Permission?.Name == permission.Name,
        (permission, m) => m.Permission = null)
        // Role Map
        .With<Role>("Roles", d => d.RoleId, s => s.Id,
        (role, m) => role.Name == m.Role?.Name,
        (role, m) => m.Role = null);
    }
}
```

Loaders work with a string Key, but can work just as easily with Any Key you prefer. By default it works with JSON files, but it can work with any file type you want, provided you override a FileLoader.
```C#
public class UsersLoader: ModelLoader<User, EntityEnum>,
    IUsersLoader
{
    public UsersLoader(
        IFileLoader fileLoader,
        IOptions<NgrootSettings> settings,
        IUserRepository userRepository
    ) : base(settings)
    {
        Setup(EntityEnum.Users)
        .FindDuplicatesWith(m => userRepository.FindByUserNameAsync(m.UserName))
        .CreateModelUsing(m => userRepository.CreateAsync(m))
        .UseFileLoader(fileLoader);
    }
}
```

Multiple extension points are located throughout the library, so you can pretty much override anything of the default functionality.

## Setup

You can start working with NGroot in 3 Simple Steps!


1. Make sure to have a C# Class for the Model you want to save to your database and some code to do the Actual Creation! (This little nuisance is what makes NGroot Agnostic from any ORM). For example, if you have an entity named Package you can start with the following:

```C#
    public class Package
    {
        public int Id { get; set; }
        public string? Name { get; set; }
    }

```

2. Create a Loader For your data:
```C#
    public interface IPackagesLoader : IModelLoader
    { }
    public class PackagesLoader : ModelLoader<Package, InitialData>, IPackagesLoader
    {
        public PackagesLoader(IOptions<NgrootSettings<InitialData>> settings, ShipmentsContext context) : base(settings)
        {
            Setup(InitialData.Packages)
                .FindDuplicatesWith(m => context.Packages.FirstOrDefaultAsync(pck => pck.Name == m.Name))
                .CreateModelUsing(async (m) =>
                {
                    context.Add(m);
                    await context.SaveChangesAsync();
                    return m;
                });
        }
    }
```

3. Add a Json File in your project Directory and a NGroot Configuration Object in your appsettings (This is required only for the time being, but Full InMemory Support is coming soon):

```jsonc
[
    {
        "Name": "My wonderful package!" // Your model should be a in JSON list format!
    }
]
```

4. Register your Model In the DI. This allows you to use any existing service in your Application to perform the model creation:
```C#
// Configure Settings
var initialDataSettingsSection = builder.Configuration.GetSection("InitialDataSettings");
builder.Services.Configure<NgrootSettings<InitialData>>(initialDataSettingsSection);
// Configure Loader
builder.Services.AddScoped<IPackagesLoader, PackagesLoader>();
```

5. Load your Model! 
```C#
    var provider = builder.Services.BuildServiceProvider();
    var app = builder.Build();

    var loaders = new List<Type> {
        typeof(IPackagesLoader),
    };
    var testLoaders = new List<Type>
    { };
    var masterLoader = new MasterLoader<InitialData>(loaders, testLoaders);
    await masterLoader.ConfigureInitialData(provider, app.Environment.ContentRootPath);

```

And Done!! Wasn't that easy? 

Yeah, It's still an early version. We'll work to make it easier over time :)